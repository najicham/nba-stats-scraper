# File: validation/configs/analytics/team_offense_game_summary.yaml
# Description: Validation config for team offense analytics
# Created: 2026-01-24

name: "team_offense_game_summary"
description: "Validates team offensive performance analytics per game"
type: "analytics"

processor:
  name: "team_offense_game_summary"
  description: "Aggregates team offensive stats per game"
  table: "nba_analytics.team_offense_game_summary"
  partition_required: true
  partition_field: "game_date"

bigquery_validations:
  enabled: true

  data_presence:
    enabled: true
    query: |
      SELECT
        game_date,
        COUNT(DISTINCT game_id) as game_count,
        COUNT(DISTINCT team_abbr) as team_count
      FROM `{project_id}.nba_analytics.team_offense_game_summary`
      WHERE game_date >= '{start_date}'
        AND game_date <= '{end_date}'
      GROUP BY game_date
      ORDER BY game_date
    severity: "warning"
    message: "Checking team offense data presence"

  teams_per_game:
    enabled: true
    query: |
      SELECT
        game_id,
        game_date,
        COUNT(DISTINCT team_abbr) as team_count
      FROM `{project_id}.nba_analytics.team_offense_game_summary`
      WHERE game_date >= '{start_date}'
        AND game_date <= '{end_date}'
      GROUP BY game_id, game_date
      HAVING COUNT(DISTINCT team_abbr) != 2
    severity: "critical"
    message: "Each game should have exactly 2 teams"
    threshold: 0

  offensive_rating_bounds:
    enabled: true
    query: |
      SELECT
        game_id,
        team_abbr,
        offensive_rating
      FROM `{project_id}.nba_analytics.team_offense_game_summary`
      WHERE game_date >= '{start_date}'
        AND game_date <= '{end_date}'
        AND (offensive_rating < 80 OR offensive_rating > 160)
    severity: "warning"
    message: "Offensive rating outside expected bounds (80-160)"

  points_consistency:
    enabled: true
    query: |
      SELECT
        game_id,
        team_abbr,
        total_points,
        field_goals_made * 2 + three_pointers_made + free_throws_made AS calculated_points
      FROM `{project_id}.nba_analytics.team_offense_game_summary`
      WHERE game_date >= '{start_date}'
        AND game_date <= '{end_date}'
        AND ABS(total_points - (field_goals_made * 2 + three_pointers_made + free_throws_made)) > 1
    severity: "critical"
    message: "Point totals inconsistent with shooting stats"
    threshold: 0

data_quality:
  required_fields:
    - game_id
    - game_date
    - team_abbr
    - opponent_team_abbr
    - total_points

notifications:
  enabled: true
  channels: ["slack"]
  on_failure: true
  on_success: false
