# File: validation/configs/analytics/team_defense_game_summary.yaml
# Description: Validation config for team defense analytics
# Created: 2026-01-24

name: "team_defense_game_summary"
description: "Validates team defensive performance analytics per game"
type: "analytics"

processor:
  name: "team_defense_game_summary"
  description: "Aggregates team defensive stats per game"
  table: "nba_analytics.team_defense_game_summary"
  partition_required: true
  partition_field: "game_date"

bigquery_validations:
  enabled: true

  data_presence:
    enabled: true
    query: |
      SELECT
        game_date,
        COUNT(DISTINCT game_id) as game_count,
        COUNT(DISTINCT team_abbr) as team_count
      FROM `{project_id}.nba_analytics.team_defense_game_summary`
      WHERE game_date >= '{start_date}'
        AND game_date <= '{end_date}'
      GROUP BY game_date
      ORDER BY game_date
    severity: "warning"
    message: "Checking team defense data presence"

  teams_per_game:
    enabled: true
    query: |
      SELECT
        game_id,
        game_date,
        COUNT(DISTINCT team_abbr) as team_count
      FROM `{project_id}.nba_analytics.team_defense_game_summary`
      WHERE game_date >= '{start_date}'
        AND game_date <= '{end_date}'
      GROUP BY game_id, game_date
      HAVING COUNT(DISTINCT team_abbr) != 2
    severity: "critical"
    message: "Each game should have exactly 2 teams"
    threshold: 0

  defensive_rating_bounds:
    enabled: true
    query: |
      SELECT
        game_id,
        team_abbr,
        defensive_rating
      FROM `{project_id}.nba_analytics.team_defense_game_summary`
      WHERE game_date >= '{start_date}'
        AND game_date <= '{end_date}'
        AND (defensive_rating < 80 OR defensive_rating > 150)
    severity: "warning"
    message: "Defensive rating outside expected bounds (80-150)"

data_quality:
  required_fields:
    - game_id
    - game_date
    - team_abbr
    - opponent_team_abbr

notifications:
  enabled: true
  channels: ["slack"]
  on_failure: true
  on_success: false
