# Slack Webhook Setup Guide

## Creating #predictions-summary Channel and Webhook

### Step 1: Create Slack Channel

1. Open your Slack workspace
2. Click the '+' button next to 'Channels' in the sidebar
3. Create a new channel:
   - **Name**: `predictions-summary`
   - **Description**: "Daily NBA prediction summaries and statistics"
   - **Privacy**: Public (recommended) or Private

### Step 2: Create Incoming Webhook

1. Go to your Slack workspace's app directory:
   - Visit: https://api.slack.com/apps
   - Or go to your workspace â†’ Settings & Administration â†’ Manage apps

2. Click "Create New App"
   - Choose "From scratch"
   - **App Name**: "NBA Daily Summary Bot"
   - **Workspace**: Select your workspace
   - Click "Create App"

3. Enable Incoming Webhooks:
   - In the left sidebar, click "Incoming Webhooks"
   - Toggle "Activate Incoming Webhooks" to **On**

4. Add New Webhook to Workspace:
   - Scroll down and click "Add New Webhook to Workspace"
   - Select the `#predictions-summary` channel
   - Click "Allow"

5. Copy the Webhook URL:
   - You'll see a webhook URL like: `https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX`
   - Copy this URL - you'll need it in the next step

### Step 3: Store Webhook in GCP Secret Manager

Run these commands in your terminal:

```bash
# Set the webhook URL (paste your actual webhook URL)
export SLACK_WEBHOOK_URL="https://hooks.slack.com/services/YOUR/WEBHOOK/URL"

# Create secret in GCP Secret Manager
echo -n "$SLACK_WEBHOOK_URL" | gcloud secrets create nba-daily-summary-slack-webhook \
  --project=nba-props-platform \
  --replication-policy="automatic" \
  --data-file=-

# Verify secret was created
gcloud secrets describe nba-daily-summary-slack-webhook --project=nba-props-platform
```

If the secret already exists, update it instead:

```bash
echo -n "$SLACK_WEBHOOK_URL" | gcloud secrets versions add nba-daily-summary-slack-webhook \
  --project=nba-props-platform \
  --data-file=-
```

### Step 4: Grant Access to Cloud Run Service Account

```bash
# Grant the Cloud Run service account access to the secret
gcloud secrets add-iam-policy-binding nba-daily-summary-slack-webhook \
  --project=nba-props-platform \
  --member="serviceAccount:nba-props-platform@appspot.gserviceaccount.com" \
  --role="roles/secretmanager.secretAccessor"
```

### Step 5: Test the Webhook (Optional)

Test that the webhook works:

```bash
curl -X POST -H 'Content-type: application/json' \
  --data '{"text":"ðŸš€ NBA Daily Summary Bot is now connected!"}' \
  $SLACK_WEBHOOK_URL
```

You should see a message appear in #predictions-summary.

---

## Next Steps

Once you've completed these steps, return to Claude Code and confirm you're ready to deploy.

Claude will then:
1. Update the monitoring container with the daily summary script
2. Create a Cloud Run Job for the daily summary
3. Create a Cloud Scheduler job to run daily at 9 AM Pacific
4. Test the deployment

---

## Message Preview

Here's what the daily summary will look like:

```
âœ… NBA Daily Prediction Summary

Date: 2026-01-17
System: CatBoost V8

Total Predictions: 500
Unique Players: 125

Avg Confidence: 85.2%
Range: 75.0% - 95.0%

Fallback Predictions: 5 (1.0%)
Status: Healthy

---

Recommendations:
â€¢ OVER: 180
â€¢ UNDER: 195
â€¢ PASS: 125

ðŸ¤– Generated by NBA Monitoring System | 2026-01-17 09:00:00 UTC
```

---

## Troubleshooting

### Secret not found
```bash
# List all secrets to verify
gcloud secrets list --project=nba-props-platform | grep slack
```

### Permission denied
```bash
# Check IAM policy
gcloud secrets get-iam-policy nba-daily-summary-slack-webhook --project=nba-props-platform
```

### Webhook not working
- Verify the webhook URL is correct (starts with https://hooks.slack.com/)
- Check that the #predictions-summary channel exists
- Ensure the app has permission to post to the channel
