{
  "displayName": "NBA Model Performance Dashboard",
  "mosaicLayout": {
    "columns": 12,
    "tiles": [
      {
        "width": 12,
        "height": 2,
        "widget": {
          "title": "Dashboard Note",
          "text": {
            "content": "This dashboard tracks ML model performance metrics. For detailed accuracy analysis, query BigQuery tables: nba_predictions.prediction_grades and prediction_accuracy_summary.",
            "format": "MARKDOWN"
          }
        }
      },
      {
        "yPos": 2,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "CatBoost V8 Model: Prediction Success Rate",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"prediction-worker\" AND (textPayload=~\"CatBoost V8.*prediction:\" OR jsonPayload.system_id=\"catboost_v8\")",
                    "aggregation": {
                      "alignmentPeriod": "3600s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_COUNT"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1"
              }
            ],
            "yAxis": {
              "label": "Predictions/hour",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 2,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "XGBoost V1 Model: Prediction Success Rate",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"prediction-worker\" AND (textPayload=~\"XGBoost V1.*prediction:\" OR jsonPayload.system_id=\"xgboost_v1\")",
                    "aggregation": {
                      "alignmentPeriod": "3600s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_COUNT"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1"
              }
            ],
            "yAxis": {
              "label": "Predictions/hour",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "yPos": 6,
        "width": 12,
        "height": 4,
        "widget": {
          "title": "High Confidence Predictions (>= 0.70)",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"prediction-worker\" AND jsonPayload.confidence_score >= 0.70",
                    "aggregation": {
                      "alignmentPeriod": "3600s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_COUNT"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1"
              }
            ],
            "yAxis": {
              "label": "High confidence predictions/hour",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "yPos": 10,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "OVER Recommendations",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"prediction-worker\" AND jsonPayload.recommendation=\"OVER\"",
                    "aggregation": {
                      "alignmentPeriod": "3600s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_COUNT"
                    }
                  }
                },
                "plotType": "STACKED_BAR",
                "targetAxis": "Y1"
              }
            ],
            "yAxis": {
              "label": "OVER recommendations/hour",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 10,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "UNDER Recommendations",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"prediction-worker\" AND jsonPayload.recommendation=\"UNDER\"",
                    "aggregation": {
                      "alignmentPeriod": "3600s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_COUNT"
                    }
                  }
                },
                "plotType": "STACKED_BAR",
                "targetAxis": "Y1"
              }
            ],
            "yAxis": {
              "label": "UNDER recommendations/hour",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "yPos": 14,
        "width": 12,
        "height": 4,
        "widget": {
          "title": "Model Loading Success at Startup",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"prediction-worker\" AND (textPayload=~\"CatBoost V8 model loaded successfully\" OR textPayload=~\"XGBoost V1 model loaded successfully\")",
                    "aggregation": {
                      "alignmentPeriod": "3600s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_COUNT"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1"
              }
            ],
            "yAxis": {
              "label": "Successful loads/hour",
              "scale": "LINEAR"
            },
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "yPos": 18,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Prediction Errors and Exceptions",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"prediction-worker\" AND severity >= \"ERROR\" AND (textPayload=~\"prediction.*failed\" OR textPayload=~\"Exception\" OR jsonPayload.error != \"\")",
                    "aggregation": {
                      "alignmentPeriod": "300s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_COUNT"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1"
              }
            ],
            "yAxis": {
              "label": "Errors/5min",
              "scale": "LINEAR"
            },
            "thresholds": [
              {
                "value": 1
              },
              {
                "value": 5
              }
            ],
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 18,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Low Confidence / PASS Recommendations",
          "xyChart": {
            "dataSets": [
              {
                "timeSeriesQuery": {
                  "timeSeriesFilter": {
                    "filter": "resource.type=\"cloud_run_revision\" AND resource.labels.service_name=\"prediction-worker\" AND (jsonPayload.recommendation=\"PASS\" OR jsonPayload.confidence_score = 0.50)",
                    "aggregation": {
                      "alignmentPeriod": "3600s",
                      "perSeriesAligner": "ALIGN_RATE",
                      "crossSeriesReducer": "REDUCE_COUNT"
                    }
                  }
                },
                "plotType": "LINE",
                "targetAxis": "Y1"
              }
            ],
            "yAxis": {
              "label": "PASS recommendations/hour",
              "scale": "LINEAR"
            },
            "thresholds": [
              {
                "value": 50
              }
            ],
            "chartOptions": {
              "mode": "COLOR"
            }
          }
        }
      }
    ]
  }
}